{% extends "base.html" %}
{% block title%}Notion Repeat{% endblock %}
{% block content %}

{% if recur %}
    <!-- Used for Icons -->
    <link href="https://cdn.materialdesignicons.com/5.3.45/css/materialdesignicons.min.css" rel="stylesheet">

    <!-- Used for searchable select/multiselect -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <!-- Used to get tzinfo -->
    <script src=/static/js/jstz.min.js></script>

    <!-- Our own script -->
    <script src=/static/js/scripts.js></script>
    <script>
        // Sets up searchable selectors
        $(document).ready(function() {
            $('.s2-single').select2({width: "100%", closeOnSelect: true});
            $('.s2-multiple').select2({width: "100%", closeOnSelect: false});
        })
    </script>
{% endif %}

<section class="section is-vertical-center">
    <div class="container">
    <form method="POST" action="">
        <!-- Connect Form -->
        {% if not recur %}
            <div class="box">
        {% else %}
            <div class="box" style="display: none;">
        {% endif %}
                <h1 class="title">Repeat TickTick</h1>
                <h2 class="subtitle">Connect to TickTick</h2>
                <div class="field">
                    <div class="control">
                        {{ connect.hidden_tag() }}
                        {{ connect.username(class="input", placeholder=connect.username.label.text) }}
                    </div>
                    {% for error in connect.username.errors %}
                        <p class="help is-danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="field has-addons">
                    <div class="control is-expanded">
                        {{ connect.password(class="input", placeholder=connect.password.label.text) }}
                    </div>
                    <div class="control">
                        {{ connect.submit(class="button is-primary") }}
                    </div>
                </div>
                {{ connect.remember }}
                {{ connect.remember.label }}
            </div>


        <!-- Recur Form -->
        {% if recur %}
            <div class="box">
                <h1 class="title">Recurring Settings</h1>
                <h2 class="subtitle">Choose how to iteratively add things</h2>
                <div class="field">
                    {{ recur.types.label }}
                    <div class="control is-expanded">
                        <div class="select is-fullwidth">
                            {{ recur.timezone(id="timezone")}}
                            {{ recur.types(onchange="recur_options()") }}
                        </div>
                    </div>
                </div>
                <div class="columns is-multiline is-centered is-0" style="margin-bottom: -0.75rem;">
                    <div class="column is-narrow" id="{{ recur.start_date.name }}" style="display: block;">
                        <div class="field is-expanded">
                            {{ recur.start_date.label }}
                            {{ recur.start_date.hidden_tag() }}
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    {{ recur.start_date.date(class="input") }}
                                </div>
                                <div class="control">
                                    {{ recur.start_date.time(class="input") }}
                                </div>
                            </div>
                            {% for error in recur.start_date.date.errors %}
                            <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow" id="{{ recur.end_date.name }}" style="display: block;">
                        <div class="field is-expanded">
                            {{ recur.end_date.label }}
                            {{ recur.end_date.hidden_tag() }}
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    {{ recur.end_date.date(class="input") }}
                                </div>
                                <div class="control">
                                    {{ recur.end_date.time(class="input") }}
                                </div>
                            </div>
                            {% for error in recur.end_date.date.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow" id="{{ recur.count.name }}" style="display: block;">
                        <div class="field">
                            {{ recur.count.label }}
                            <div class="control">
                                {{ recur.count(class="input") }}
                            </div>
                            {% for error in recur.count.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow">
                        <table class="table is-narrow" id="recur_days">
                            <thead>
                                <tr>
                                    <th>Sun</th>
                                    <th>M</th>
                                    <th>Tu</th>
                                    <th>W</th>
                                    <th>Th</th>
                                    <th>F</th>
                                    <th>Sat</th>
                                    <th>All</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th style="text-align:center">{{ recur.Sun }}</th>
                                    <th style="text-align:center">{{ recur.M }}</th>
                                    <th style="text-align:center">{{ recur.Tu }}</th>
                                    <th style="text-align:center">{{ recur.W }}</th>
                                    <th style="text-align:center">{{ recur.Th }}</th>
                                    <th style="text-align:center">{{ recur.F }}</th>
                                    <th style="text-align:center">{{ recur.Sat }}</th>
                                    <th style="text-align:center"><input type="checkbox" id="all-days" onclick="toggle(this);" ></th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Notion Columns -->
        {% if columns %}
            <div class="box">
                <h1 class="title">Notion Columns</h1>
                <h2 class="subtitle">Fill in your info</h2>
                <div class="field is-horizontal">
                    <div class="field-label">
                        {{ columns.title.label }}
                    </div>
                    <div class="field-body">
                        <div class="field">
                            <div class="control has-icons-left">
                                {{ columns.title(class="input") }}
                                <span class="icon is-left">
                                    <span class="mdi mdi-24px mdi-format-font"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field is-horizontal">
                    <div class="field-label">
                        {{ columns.list.label }}
                    </div>
                    <div class="field-body">
                        <div class="field">
                            <div class="control has-icons-left is-expanded">
                                <div class="select is-fullwidth">
                                    {{ columns.list(class="s2-single", id="List") }}
                                </div>
                                <span class="icon is-left">
                                    <span class="mdi mdi-24px mdi-arrow-down-drop-circle"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field is-horizontal" id="{{ columns.dueDate.name }}_div">
                    {{ columns.dueDate.hidden_tag() }}
                    <div class="field-label">
                        {{ columns.dueDate.label }}
                    </div>
                    <div class="field-body">
                        <div class="field is-expanded">
                            <div class="field has-addons">
                                <div class="control is-expanded has-icons-left">
                                    {{ columns.dueDate.date(class="input") }}
                                    <span class="icon is-left">
                                        <span class="mdi mdi-24px mdi-calendar-text"></span>
                                    </span>
                                </div>
                                <div class="control">
                                    {{ columns.dueDate.time(class="input") }}
                                </div>
                            </div>
                            {% for error in columns.dueDate.date.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="field is-horizontal">
                    <div class="field-label">
                        {{ columns.tags.label }}
                    </div>
                    <div class="field-body">
                        <div class="field">
                            <div class="control has-icons-left is-expanded">
                                <div class="select is-multiple is-fullwidth">
                                    {{ columns.tags(class="s2-multiple", id=columns.tags.name) }}
                                </div>
                                <span class="icon is-left">
                                    <span class="mdi mdi-24px mdi-format-list-bulleted"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field is-horizontal">
                    <div class="field-label">
                        {{ columns.priority.label }}
                    </div>
                    <div class="field-body">
                        <div class="field">
                            <div class="control has-icons-left is-expanded">
                                <div class="select is-fullwidth">
                                    {{ columns.priority(class="s2-single", id="List") }}
                                </div>
                                <span class="icon is-left">
                                    <span class="mdi mdi-24px mdi-arrow-down-drop-circle"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="field is-grouped" style="display: block;">
                        {{ connect.submit(class="button is-primary") }}
                        {{ connect.goback(class="button is-danger is-pulled-right") }}
                    </div>
                </div>
            </div>
        {% endif %}
    </form>
</div>
</section>
{% endblock %}
