{% extends "base.html" %}
{% block title%}Notion Repeat{% endblock %}
{% block content %}

{% if recur %}
    <script>
        window.onload = function() {
            date_visibility();
            recur_options();
        };
        $(document).ready(function() {
            $('.s2-single').select2({width: "100%", closeOnSelect: true});
            $('.s2-multiple').select2({width: "100%"});
            // if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
            //     $(".s2-single").select2('destroy');
            //     $(".s2-multiple").select2('destroy');
            // }
        });
        </script>
{% endif %}
<section class="section is-vertical-center">
    <div class="container">
    <form method="POST" action="">
        <!-- Connect Form -->
        {% if not recur %}
            <div class="box">
        {% else %}
            <div class="box" style="display: none;">
        {% endif %}
                <h1 class="title">Repeat Notion</h1>
                <h2 class="subtitle">Connect to Notion</h2>
                <div class="field">
                    <div class="control">
                        {{ connect.hidden_tag() }}
                        {{ connect.url(class="input", placeholder=connect.url.label.text) }}
                    </div>
                    {% for error in connect.url.errors %}
                        <p class="help is-danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="field has-addons">
                    <div class="control is-expanded">
                        {{ connect.token(class="input", placeholder=connect.token.label.text) }}
                    </div>
                    <div class="control">
                        {{ connect.submit(class="button is-primary") }}
                    </div>
                </div>
                {{ connect.remember }}
                {{ connect.remember.label }}
            </div>


        <!-- Recur Form -->
        {% if recur %}
            <div class="box">
                <h1 class="title">Recurring Settings</h1>
                <h2 class="subtitle">Choose how to iteratively add things</h2>
                <div class="field">
                    {{ recur.types.label }}
                    <div class="control is-expanded">
                        <div class="select is-fullwidth">
                            {{ recur.types(onchange="recur_options()") }}
                        </div>
                    </div>
                </div>
                <div class="columns is-multiline is-centered is-0" style="margin-bottom: -0.75rem;">
                    <div class="column is-narrow" id="{{ recur.start_date.name }}" style="display: block;">
                        <div class="field is-expanded">
                            {{ recur.start_date.label }}
                            {{ recur.start_date.hidden_tag() }}
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    {{ recur.start_date.date(class="input") }}
                                </div>
                                <div class="control">
                                    {{ recur.start_date.time(class="input") }}
                                </div>
                            </div>
                            {% for error in recur.start_date.date.errors %}
                            <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow" id="{{ recur.end_date.name }}" style="display: block;">
                        <div class="field is-expanded">
                            {{ recur.end_date.label }}
                            {{ recur.end_date.hidden_tag() }}
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    {{ recur.end_date.date(class="input") }}
                                </div>
                                <div class="control">
                                    {{ recur.end_date.time(class="input") }}
                                </div>
                            </div>
                            {% for error in recur.end_date.date.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow" id="{{ recur.count.name }}" style="display: block;">
                        <div class="field">
                            {{ recur.count.label }}
                            <div class="control">
                                {{ recur.count(class="input") }}
                            </div>
                            {% for error in recur.count.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="column is-narrow" id="{{ recur.date_options.name }}_div" style="display: block;">
                        <div class="field">
                            {{ recur.date_options.label }}
                            <div class="control is-expanded">
                                <div class="select is-fullwidth">
                                    {{ recur.date_options(onchange="date_visibility()") }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="column is-narrow">
                        <table class="table is-narrow" id="recur_days">
                            <thead>
                                <tr>
                                    <th>Sun</th>
                                    <th>M</th>
                                    <th>Tu</th>
                                    <th>W</th>
                                    <th>Th</th>
                                    <th>F</th>
                                    <th>Sat</th>
                                    <th>All</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th style="text-align:center">{{ recur.Sun }}</th>
                                    <th style="text-align:center">{{ recur.M }}</th>
                                    <th style="text-align:center">{{ recur.Tu }}</th>
                                    <th style="text-align:center">{{ recur.W }}</th>
                                    <th style="text-align:center">{{ recur.Th }}</th>
                                    <th style="text-align:center">{{ recur.F }}</th>
                                    <th style="text-align:center">{{ recur.Sat }}</th>
                                    <th style="text-align:center"><input type="checkbox" id="all-days" onclick="toggle(this);" ></th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Notion Columns -->
        {% if columns %}
            <div class="box">
                <h1 class="title">Notion Columns</h1>
                <h2 class="subtitle">Fill in your info</h2>
                {% for field in columns if field.widget.input_type != 'hidden' %}
                    {% if field.id == "email" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-at"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "text" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-format-align-left"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "url" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-link-variant"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "phone_number" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-phone"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "select" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left is-expanded">
                                        <div class="select is-fullwidth">
                                            {{ field(class="s2-single", id=field.name) }}
                                        </div>
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-arrow-down-drop-circle"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "title" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-format-font"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "multi_select" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left is-expanded">
                                        <div class="select is-multiple is-fullwidth">
                                            {{ field(class="s2-multiple", id=field.name) }}
                                        </div>
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-format-list-bulleted"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "relation" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left is-expanded">
                                        <div class="select is-multiple is-fullwidth">
                                            {{ field(class="s2-multiple", id=field.name) }}
                                        </div>
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-format-list-bulleted"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "person" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left is-expanded">
                                        <div class="select is-multiple is-fullwidth">
                                            {{ field(class="s2-multiple", id=field.name) }}
                                        </div>
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-account-group"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "number" %}
                        <div class="field is-horizontal">
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control has-icons-left">
                                        {{ field(class="input") }}
                                        <span class="icon is-left">
                                            <span class="mdi mdi-24px mdi-pound"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "file" %}
                    <div class="field is-horizontal">
                        <div class="field-label">
                            {{ field.label }}
                        </div>
                        <div class="field-body">
                            <div class="field">
                                <div class="control has-icons-left">
                                    {{ field(class="input") }}
                                    <span class="icon is-left">
                                        <span class="mdi mdi-24px mdi-attachment"></span>
                                    </span>
                                </div>
                                {% for error in field.errors %}
                                    <p class="help is-danger">{{ error }}</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    {% elif field.id == "date" %}
                        <div class="field is-horizontal" id="{{ field.name }}_div">
                            {{ field.hidden_tag() }}
                            <div class="field-label">
                                {{ field.label }}
                            </div>
                            <div class="field-body">
                                <div class="field is-expanded">
                                    <div class="field has-addons">
                                        <div class="control is-expanded has-icons-left">
                                            {{ field.date(class="input") }}
                                            <span class="icon is-left">
                                                <span class="mdi mdi-24px mdi-calendar-text"></span>
                                            </span>
                                        </div>
                                        <div class="control">
                                            {{ field.time(class="input") }}
                                        </div>
                                    </div>
                                    {% for error in field.date.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                    {% elif field.id == "checkbox" %}
                    <div class="field is-horizontal" id="{{ field.name }}_div">
                        <div class="field-label">
                            {{ field.label }}
                        </div>
                        <div class="field-body">
                            <div class="field">
                                <div class="control">
                                    {{ field }}
                                </div>
                            </div>
                        </div>
                    </div>

                    {% endif %}
                {% endfor %}
                <div class="container">
                    <div class="field is-grouped" style="display: block;">
                        {{ connect.submit(class="button is-primary") }}
                        {{ connect.goback(class="button is-danger is-pulled-right") }}
                    </div>
                </div>
            </div>
        {% endif %}
    </form>
</div>
</section>
{% endblock %}
